<!-- <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–‡ä»¶å†…å®¹å¤„ç†å™¨</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            display: flex;
            flex-direction: column;
            height: 95vh;
        }
        .container {
            display: flex;
            flex: 1;
        }
        .left-panel {
            width: 30%;
            padding-right: 20px;
        }
        .right-panel {
            width: 70%;
        }
        #preview {
            white-space: pre-wrap;
            border: 1px solid #ccc;
            padding: 10px;
            height: calc(100% - 40px);
            overflow-y: auto;
        }
        button {
            margin-bottom: 10px;
        }
        #fileList {
            border: 1px solid #ccc;
            padding: 10px;
            height: calc(100% - 40px);
            overflow-y: auto;
        }
        #log {
            border-top: 1px solid #ccc;
            padding: 10px;
            height: 100px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>æ–‡ä»¶å†…å®¹å¤„ç†å™¨</h1>
    <div class="container">
        <div class="left-panel">
            <button onclick="chooseFiles()">é€‰æ‹©æ–‡ä»¶</button>
            <div id="fileList"></div>
        </div>
        <div class="right-panel">
            <button onclick="copyContent()">å¤åˆ¶å†…å®¹</button>
            <div id="preview"></div>
        </div>
    </div>
    <div id="log"></div>

    <script>
        let selectedFiles = [];
        let combinedContent = '';

        function log(message) {
            const logElement = document.getElementById('log');
            logElement.innerHTML += new Date().toLocaleTimeString() + ': ' + message + '<br>';
            logElement.scrollTop = logElement.scrollHeight;
            console.log(message);
        }

        // function chooseFiles() {
        //     log('å°è¯•æ‰“å¼€æ–‡ä»¶é€‰æ‹©å¯¹è¯æ¡†...');
        //     const result = utools.showOpenDialog({
        //         filters: [{ name: 'All Files', extensions: ['*'] }],
        //         properties: ['openFile', 'multiSelections']
        //     });
            
        //     if (result && result.length > 0) {
        //         log('æ–‡ä»¶é€‰æ‹©æˆåŠŸï¼Œé€‰ä¸­äº† ' + result.length + ' ä¸ªæ–‡ä»¶');
        //         selectedFiles = result;
        //         updateFileList();
        //         processFiles();
        //     } else {
        //         log('æœªé€‰æ‹©ä»»ä½•æ–‡ä»¶');
        //     }
        // }

        function chooseFiles() {
    log('å°è¯•æ‰“å¼€æ–‡ä»¶é€‰æ‹©å¯¹è¯æ¡†...');
    const result = utools.showOpenDialog({
        filters: [{ name: 'All Files', extensions: ['*'] }],
        properties: ['openFile', 'multiSelections']
    });
    
    if (result && result.length > 0) {
        log('æ–‡ä»¶é€‰æ‹©æˆåŠŸï¼Œé€‰ä¸­äº† ' + result.length + ' ä¸ªæ–‡ä»¶');
        selectedFiles = result;
        
        // æ‰“å°è·å–çš„æ–‡ä»¶è·¯å¾„
        log('è·å–çš„æ–‡ä»¶è·¯å¾„:');
        result.forEach((path, index) => {
            log(`æ–‡ä»¶ ${index + 1}: ${path}`);
        });
        
        updateFileList();
        processFiles();
    } else {
        log('æœªé€‰æ‹©ä»»ä½•æ–‡ä»¶');
    }
}


        function updateFileList() {
            const fileList = document.getElementById('fileList');
            fileList.innerHTML = '<h3>é€‰æ‹©çš„æ–‡ä»¶ï¼š</h3>' + selectedFiles.map(file => `<div>${file}</div>`).join('');
            log('æ–‡ä»¶åˆ—è¡¨å·²æ›´æ–°ï¼Œå…± ' + selectedFiles.length + ' ä¸ªæ–‡ä»¶');
        }

        function processFiles() {
            if (selectedFiles.length === 0) {
                log('æ²¡æœ‰é€‰æ‹©æ–‡ä»¶ï¼Œæ— æ³•å¤„ç†');
                return;
            }
            log('å¼€å§‹å¤„ç†æ–‡ä»¶...');
            try {
                const files = window.readFiles(selectedFiles);
                combinedContent = files.map(file => `# ${file.name}\n\n${file.content}`).join('\n\n');
                document.getElementById('preview').textContent = combinedContent;
                log('æ–‡ä»¶å¤„ç†å®Œæˆï¼Œé¢„è§ˆå·²æ›´æ–°');
            } catch (error) {
                log('å¤„ç†æ–‡ä»¶æ—¶å‡ºé”™: ' + error);
            }
        }

        function copyContent() {
            if (!combinedContent) {
                log('æ²¡æœ‰å†…å®¹å¯å¤åˆ¶');
                return;
            }
            try {
                window.copyToClipboard(combinedContent);
                log('å†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
            } catch (error) {
                log('å¤åˆ¶åˆ°å‰ªè´´æ¿æ—¶å‡ºé”™: ' + error);
            }
        }

        window.exports = {
            'file-processor': {
                mode: 'none',
                args: {
                    enter: (action, callbackSetList) => {
                        log('æ’ä»¶å·²å¯åŠ¨');
                    }
                }
            }
        }

        window.onload = function() {
            log('é¡µé¢å·²åŠ è½½ï¼Œæ’ä»¶å°±ç»ª');
        }
    </script>
</body>
</html> -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–‡ä»¶å†…å®¹å¤„ç†å™¨</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 20px;
            background-color: #f0f4f8;
            color: #333;
            margin: 0;
            overflow-y: auto;
            height: 100vh;
        }
        .main-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .container {
            display: flex;
            gap: 20px;
        }
        .panel {
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 20px;
            display: flex;
            flex-direction: column;
        }
        .left-panel {
            width: 30%;
        }
        .right-panel {
            width: 70%;
        }
        #preview {
            white-space: pre-wrap;
            flex: 1;
            overflow-y: auto;
            font-family: 'Courier New', Courier, monospace;
            font-size: 14px;
            padding: 10px 0;
            max-height: 300px;
        }
        button {
            background-color: #4a90e2;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-bottom: 10px;
        }
        button:hover {
            background-color: #357abd;
        }
        #fileList {
            flex: 1;
            overflow-y: auto;
            padding: 10px 0;
            max-height: 300px;
        }
        #log {
            background-color: #ffffff;
            border-radius: 4px;
            padding: 10px;
            height: 100px;
            overflow-y: auto;
            font-family: 'Courier New', Courier, monospace;
            font-size: 12px;
        }
        h1, h3 {
            margin-top: 0;
            color: #2c3e50;
        }
        .file-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 5px 0;
        }
        .file-icon {
            margin-right: 10px;
            color: #4a90e2;
        }
        .remove-file {
            color: #e74c3c;
            cursor: pointer;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="container">
            <div class="left-panel panel">
                <button onclick="chooseFiles()">é€‰æ‹©æ–‡ä»¶</button>
                <div id="fileList"></div>
            </div>
            <div class="right-panel panel">
                <button onclick="copyContent()">å¤åˆ¶å†…å®¹</button>
                <div id="preview"></div>
            </div>
        </div>
        <div id="log" class="panel"></div>
    </div>

    <script>
        let selectedFiles = [];
        let combinedContent = '';

        function log(message) {
            const logElement = document.getElementById('log');
            const logEntry = document.createElement('div');
            logEntry.textContent = `${new Date().toLocaleTimeString()}: ${message}`;
            logElement.appendChild(logEntry);
            logElement.scrollTop = logElement.scrollHeight;
            console.log(message);
        }

        function chooseFiles() {
            log('å°è¯•æ‰“å¼€æ–‡ä»¶é€‰æ‹©å¯¹è¯æ¡†...');
            const result = utools.showOpenDialog({
                filters: [{ name: 'All Files', extensions: ['*'] }],
                properties: ['openFile', 'multiSelections']
            });
            
            if (result && result.length > 0) {
                log('æ–‡ä»¶é€‰æ‹©æˆåŠŸï¼Œé€‰ä¸­äº† ' + result.length + ' ä¸ªæ–‡ä»¶');
                selectedFiles = result;
                
                log('è·å–çš„æ–‡ä»¶è·¯å¾„:');
                result.forEach((path, index) => {
                    log(`æ–‡ä»¶ ${index + 1}: ${path}`);
                });
                
                updateFileList();
                processFiles();
            } else {
                log('æœªé€‰æ‹©ä»»ä½•æ–‡ä»¶');
            }
        }

        function updateFileList() {
            const fileList = document.getElementById('fileList');
            fileList.innerHTML = '<h3>é€‰æ‹©çš„æ–‡ä»¶ï¼š</h3>' + selectedFiles.map((file, index) => 
                `<div class="file-item">
                    <span><span class="file-icon">ğŸ“„</span>${file.split('/').pop()}</span>
                    <span class="remove-file" onclick="removeFile(${index})">âœ–</span>
                </div>`
            ).join('');
            log('æ–‡ä»¶åˆ—è¡¨å·²æ›´æ–°ï¼Œå…± ' + selectedFiles.length + ' ä¸ªæ–‡ä»¶');
        }

        function removeFile(index) {
            selectedFiles.splice(index, 1);
            updateFileList();
            processFiles();
        }

        function processFiles() {
    if (selectedFiles.length === 0) {
        log('æ²¡æœ‰é€‰æ‹©æ–‡ä»¶ï¼Œæ— æ³•å¤„ç†');
        document.getElementById('preview').textContent = '';
        combinedContent = '';
        return;
    }
    log('å¼€å§‹å¤„ç†æ–‡ä»¶...');
    try {
        const files = window.readFiles(selectedFiles);
        combinedContent = files.map(file => 
            `# ${selectedFiles.find(path => path.endsWith(file.name))}çš„å†…å®¹æ˜¯:\n\`\`\`\n${file.content}\n\`\`\``
        ).join('\n\n');
        document.getElementById('preview').textContent = combinedContent;
        log('æ–‡ä»¶å¤„ç†å®Œæˆï¼Œé¢„è§ˆå·²æ›´æ–°');
    } catch (error) {
        log('å¤„ç†æ–‡ä»¶æ—¶å‡ºé”™: ' + error);
    }
}


        function copyContent() {
            if (!combinedContent) {
                log('æ²¡æœ‰å†…å®¹å¯å¤åˆ¶');
                return;
            }
            try {
                window.copyToClipboard(combinedContent);
                log('å†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
            } catch (error) {
                log('å¤åˆ¶åˆ°å‰ªè´´æ¿æ—¶å‡ºé”™: ' + error);
            }
        }

        window.exports = {
            'file-processor': {
                mode: 'none',
                args: {
                    enter: (action, callbackSetList) => {
                        log('æ’ä»¶å·²å¯åŠ¨');
                    }
                }
            }
        }

        window.onload = function() {
            log('é¡µé¢å·²åŠ è½½ï¼Œæ’ä»¶å°±ç»ª');
        }
    </script>
</body>
</html>
